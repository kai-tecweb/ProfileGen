# 相談チャット機能 ナレッジのみ使用の厳格化レポート

修正日時: 2025年12月4日

## 問題点

ナレッジにある質問でもAIが独自解釈を追加してしまう問題が残っていた。

- AIが記事に書かれていない情報を追加してしまう
- 「一般的には」「推測すると」などの表現が含まれる
- 記事に無い事例や応用を追加してしまう

## 修正内容

### 修正前の問題

- ナレッジにある質問でもAIが独自の推測・憶測を追加していた
- 記事に書かれていない情報が含まれることがあった
- 「もしかしたら」「おそらく」「推測すると」「一般的には」などの表現が使われていた

### 修正後の改善

1. **記事知識に書かれている内容のみを使用**
   - 「記事知識に書かれている内容**のみ**を使用してください」と明示
   - AIとしての独自の推測・憶測を一切禁止

2. **禁止表現を明示**
   - 「もしかしたら」「おそらく」「推測すると」「一般的には」などの表現を禁止
   - 記事に無い事例、記事に無い応用、記事に無い背景説明の追加を禁止

3. **各セクションでの記事内容のみの使用を指示**
   - 【要約】：記事の要点をまとめる（記事の内容のみ）
   - 【今すぐやること】：記事に書かれている具体的なアクション（記事の内容のみ）
   - 【アドバイス】：記事に書かれている心構えや注意点（記事の内容のみ）
   - 【詳細】：記事の詳しい内容を整理して記載（記事の内容のみ）

## 修正後のプロンプト（追加部分）

```
【ナレッジにある質問の場合の厳守事項】
- 記事知識に書かれている内容**のみ**を使用してください
- AIとしての独自の推測・憶測は一切加えないでください
- 記事に書かれていない情報は追加しないでください
- 記事の内容を忠実に、分かりやすく整理して伝えてください
- 「もしかしたら」「おそらく」「推測すると」「一般的には」などの表現は使わないでください
- 記事に書かれている事実・手順・アドバイスをそのまま伝えてください
- 記事に無い事例、記事に無い応用、記事に無い背景説明は絶対に追加しないでください

【回答の作り方】
- 【要約】：記事の要点をまとめる（記事の内容のみ）
- 【今すぐやること】：記事に書かれている具体的なアクション（記事の内容のみ）
- 【アドバイス】：記事に書かれている心構えや注意点（記事の内容のみ）
- 【詳細】：記事の詳しい内容を整理して記載（記事の内容のみ）

記事に書かれていないことは絶対に追加しないでください。
```

## テスト方法

### テスト質問

**質問**: 「ココナラで商品を初めて出品する時の手順を教えてください」

### 確認ポイント

- ✅ 記事に書かれている内容のみを返しているか
- ✅ AIの独自解釈・推測が含まれていないか
- ✅ 「一般的には」「推測すると」などの表現が無いか
- ✅ 記事に無い事例や応用が追加されていないか

### 期待される結果

- 記事の内容のみを使用した回答
- AIの独自解釈が一切含まれていない
- 禁止表現（「もしかしたら」「おそらく」「推測すると」「一般的には」など）が使われていない
- 記事に無い事例や応用が追加されていない

## デプロイ状況

- ✅ Gitコミット・プッシュ完了
- ✅ サーバー側のコード更新完了
- ✅ キャッシュクリア完了

## 次のステップ

1. ブラウザで `https://navyracoon2.sakura.ne.jp/student/consultations` にアクセス
2. 「ココナラで商品を初めて出品する時の手順を教えてください」という質問でテスト実行
3. 記事に書かれている内容のみが返されているか確認
4. AIの独自解釈・推測が含まれていないか確認
5. 禁止表現（「一般的には」「推測すると」など）が使われていないか確認

## 修正ファイル

- `app/Http/Controllers/Student/ConsultationController.php` (124-137行目)

## 関連ドキュメント

- プロンプト修正レポート: `docs/archive/2025-12-04/CONSULTATION_PROMPT_FIX.md`
- ナレッジ無し対応の修正: `docs/archive/2025-12-04/CONSULTATION_NO_KNOWLEDGE_FIX.md`
- テスト手順: `docs/archive/2025-12-04/TEST_CONSULTATION_PROMPT.md`

