# 相談チャット機能 プロンプトテスト手順

テスト日時: 2025年12月4日

## テスト目的

新しいプロンプト形式が正しく動作するか確認するため、以下の2つの質問でテストします：

1. **ナレッジにある質問**: 記事知識を参照して回答する
2. **ナレッジに無い質問**: 記事知識に関連する情報がない場合の対応を確認

## テスト手順

### 1. 学生側の相談チャット画面にアクセス

1. ブラウザで `https://navyracoon2.sakura.ne.jp/student/login` にアクセス
2. 学生用のログイン情報でログイン
3. 相談チャット画面 (`/student/consultations`) に移動

### 2. テスト質問1: ナレッジにある内容

**質問**: 「ココナラで商品を初めて出品する時の手順を教えてください」

**確認ポイント**:
- ✅ 回答が4段階構造になっているか
  - 【要約】セクションが存在するか
  - 【今すぐやること】セクションが存在するか
  - 【アドバイス】セクションが存在するか
  - 【詳細】セクションが存在するか（折りたたみ可能）
- ✅ 記事知識を参照した回答になっているか
- ✅ 各セクションが適切に表示されているか（色分け、アイコンなど）

**期待される結果**:
```
【要約】
ココナラで商品を初めて出品するには、アカウント登録、商品内容の作成、価格設定、公開設定などの手順が必要です。

【今すぐやること】
• ココナラにアカウント登録する
• 出品したい商品の内容を整理する
• 商品タイトルと説明文を作成する
• 価格を設定する
• 公開設定を行う

【アドバイス】
• 最初は完璧を求めず、まずは1つ出品してみることが大切です
• 商品説明は具体的で分かりやすく書くことが重要です

【詳細】
（詳しい説明がここに表示される）
```

### 3. テスト質問2: ナレッジに無い内容

**質問**: 「明日の東京の天気予報を教えてください」

**確認ポイント**:
- ✅ 回答が4段階構造になっているか
- ✅ 【要約】セクションに「記事知識には該当する情報がありませんでした」と明記されているか
- ✅ 一般的な知識で役立つアドバイスを提供しているか

**期待される結果**:
```
【要約】
記事知識には該当する情報がありませんでした。天気予報については、気象庁の公式サイトや天気予報アプリを確認することをお勧めします。

【今すぐやること】
• 気象庁の公式サイト（https://www.jma.go.jp/）を確認する
• 天気予報アプリ（Yahoo!天気、tenki.jpなど）を確認する
• 外出予定がある場合は、傘を持参するか確認する

【アドバイス】
• 天気予報は時間が経つと変わる可能性があるため、当日の朝にも確認することをお勧めします
• 急な天候の変化に備えて、折りたたみ傘を持ち歩くと便利です

【詳細】
（詳しい説明がここに表示される）
```

## テスト結果の記録

### テスト質問1の結果

- [ ] 4段階構造になっている
- [ ] 【要約】セクションが存在する
- [ ] 【今すぐやること】セクションが存在する
- [ ] 【アドバイス】セクションが存在する
- [ ] 【詳細】セクションが存在する
- [ ] 記事知識を参照した回答になっている
- [ ] 各セクションが適切に表示されている

**実際の回答**:
```
（ここに実際の回答を貼り付けてください）
```

### テスト質問2の結果

- [ ] 4段階構造になっている
- [ ] 【要約】セクションに「記事知識には該当する情報がありませんでした」と明記されている
- [ ] 一般的な知識で役立つアドバイスを提供している

**実際の回答**:
```
（ここに実際の回答を貼り付けてください）
```

## 問題が発生した場合

### 4段階構造になっていない場合

1. プロンプトの指示が弱い可能性
   - `app/Http/Controllers/Student/ConsultationController.php` のプロンプトを確認
   - 【絶対に守るべきルール】が最初に配置されているか確認

2. LLMが指示を無視している可能性
   - プロンプトをさらに強化する
   - 例をより具体的にする

### ナレッジに無い質問への対応が不明確な場合

1. 【重要】セクションの指示を確認
2. 「記事知識には該当する情報がありませんでした」という文言が明記されているか確認
3. プロンプトをさらに明確にする

## 修正が必要な場合

問題が発生した場合は、`app/Http/Controllers/Student/ConsultationController.php` のプロンプトを修正し、再度デプロイしてください。

## 参考

- プロンプト修正レポート: `docs/archive/2025-12-04/CONSULTATION_PROMPT_FIX.md`
- 修正ファイル: `app/Http/Controllers/Student/ConsultationController.php` (86-114行目)

