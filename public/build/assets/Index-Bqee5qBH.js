import{r as p,u as v,j as e,H as _,a as i}from"./app-7qfK9I34.js";import{A as C}from"./AdminV2Layout-BMPkReqh.js";import{s as h}from"./index-ikzcNs2d.js";import{B as d}from"./Button-BA9Tpm1N.js";import{M as S}from"./Modal-DNagqtOL.js";import{I as l}from"./InputLabel-pHdMUJax.js";import{I as u}from"./InputError-9PqMVSGh.js";import"./transition-BUtyYROC.js";function E({consultations:a}){const[g,t]=p.useState(!1),[r,o]=p.useState(null),{data:n,setData:c,post:y,processing:x,errors:m,reset:j}=v({correct_answer:"",corrected_by:""}),b=s=>{o(s),c({correct_answer:"",corrected_by:""}),t(!0)},w=s=>{s.preventDefault(),r&&y(h("admin.consultations.correct",r.id),{preserveScroll:!0,onSuccess:()=>{t(!1),o(null),j(),i.reload()}})},f=s=>{confirm("Discordに投稿しますか？")&&i.post(h("admin.consultations.notify",s))};return e.jsxs(C,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"相談履歴管理"}),children:[e.jsx(_,{title:"相談履歴管理"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx("div",{className:"p-6",children:a.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"質問"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"回答"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"日時"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"修正済み"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.data.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:e.jsx("div",{className:"whitespace-pre-wrap break-words",children:s.question.length>100?s.question.substring(0,100)+"...":s.question})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:e.jsx("div",{className:"whitespace-pre-wrap break-words",children:s.answer.length>100?s.answer.substring(0,100)+"...":s.answer})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.created_at).toLocaleString("ja-JP")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:s.is_corrected?e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800",children:"修正済み"}):e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:"未修正"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx(d,{variant:"secondary",onClick:()=>b(s),children:"修正"}),e.jsx(d,{variant:"secondary",onClick:()=>f(s.id),children:"Discord投稿"})]})]},s.id))})]})}),a.last_page>1&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("nav",{className:"flex space-x-2",children:a.links.map((s,N)=>e.jsx("button",{onClick:()=>{s.url&&i.visit(s.url)},disabled:!s.url||s.active,className:`px-3 py-2 rounded-md text-sm font-medium ${s.active?"bg-blue-600 text-white":s.url?"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:s.label}},N))})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"相談履歴がありません"})})})})})}),e.jsx(S,{show:g,onClose:()=>t(!1),title:"回答を修正",maxWidth:"2xl",children:r&&e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{htmlFor:"original_question",value:"質問"}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded-md border border-gray-300",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:r.question})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{htmlFor:"original_answer",value:"元の回答"}),e.jsx("div",{className:"mt-1 p-3 bg-yellow-50 rounded-md border border-yellow-300 max-h-96 overflow-y-auto",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:r.answer})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{htmlFor:"correct_answer",value:"正しい回答（必須）"}),e.jsx("textarea",{id:"correct_answer",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:10,value:n.correct_answer,onChange:s=>c("correct_answer",s.target.value),required:!0,placeholder:"正しい回答を入力してください"}),e.jsx(u,{message:m.correct_answer,className:"mt-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{htmlFor:"corrected_by",value:"修正者名（任意）"}),e.jsx("input",{type:"text",id:"corrected_by",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",value:n.corrected_by,onChange:s=>c("corrected_by",s.target.value),placeholder:"修正者名を入力（空欄の場合はAdmin）"}),e.jsx(u,{message:m.corrected_by,className:"mt-2"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(d,{type:"button",variant:"secondary",onClick:()=>t(!1),children:"キャンセル"}),e.jsx(d,{type:"submit",disabled:x,children:x?"修正中...":"修正する"})]})]})})]})}export{E as default};
